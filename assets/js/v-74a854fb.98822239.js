"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[4985],{9689:(n,s,a)=>{a.r(s),a.d(s,{data:()=>p});const p={key:"v-74a854fb",path:"/VueJs3/section3/chapter11.html",title:"å¿«é€Ÿ Diff ç®—æ³•",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"ç›¸åŒçš„å‰ç½®å…ƒç´ å’Œåç½®å…ƒç´ ",slug:"ç›¸åŒçš„å‰ç½®å…ƒç´ å’Œåç½®å…ƒç´ ",children:[{level:3,title:"çº¯æ–‡æœ¬ Diff ç®—æ³•",slug:"çº¯æ–‡æœ¬-diff-ç®—æ³•",children:[]},{level:3,title:"å¿«é€Ÿ Diff ç®—æ³•",slug:"å¿«é€Ÿ-diff-ç®—æ³•-1",children:[]}]},{level:2,title:"ç§»åŠ¨æ“ä½œåˆ¤æ–­",slug:"ç§»åŠ¨æ“ä½œåˆ¤æ–­",children:[{level:3,title:"souce æ•°ç»„",slug:"souce-æ•°ç»„",children:[]},{level:3,title:"ç´¢å¼•è¡¨é™ä½æ—¶é—´å¤æ‚åº¦",slug:"ç´¢å¼•è¡¨é™ä½æ—¶é—´å¤æ‚åº¦",children:[]},{level:3,title:"èŠ‚ç‚¹ç§»åŠ¨åˆ¤æ–­",slug:"èŠ‚ç‚¹ç§»åŠ¨åˆ¤æ–­",children:[]}]},{level:2,title:"å¦‚ä½•ç§»åŠ¨å…ƒç´ ",slug:"å¦‚ä½•ç§»åŠ¨å…ƒç´ ",children:[{level:3,title:"æœ€é•¿é€’å¢å­åºåˆ—",slug:"æœ€é•¿é€’å¢å­åºåˆ—",children:[]},{level:3,title:"ç§»åŠ¨ä¸æŒ‚è½½",slug:"ç§»åŠ¨ä¸æŒ‚è½½",children:[]}]},{level:2,title:"æ€»ç»“",slug:"æ€»ç»“",children:[]}],filePathRelative:"VueJs3/section3/chapter11.md",git:{updatedTime:1656479933e3,contributors:[{name:"Jerry Chen",email:"caffreygo@163.com",commits:3},{name:"Jinrui Chen",email:"jinrui@kooboo.cn",commits:1}]}}},4787:(n,s,a)=>{a.r(s),a.d(s,{default:()=>l});var p=a(6252);const e=(0,p.uE)('<h1 id="å¿«é€Ÿ-diff-ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#å¿«é€Ÿ-diff-ç®—æ³•" aria-hidden="true">#</a> å¿«é€Ÿ Diff ç®—æ³•</h1><p>å¿«é€Ÿ Diff ç®—æ³•æœ€æ—©åº”ç”¨äº ivi å’Œ inferno è¿™ä¸¤ä¸ªæ¡†æ¶ï¼Œåœ¨ DOM æ“ä½œçš„å„ä¸ªæ–¹é¢ï¼Œè¿™ä¸ªç®—æ³•æ€§èƒ½éƒ½è¦ç¨ä¼˜äº Vue.js 2 æ‰€é‡‡ç”¨çš„åŒç«¯ Diff ç®—æ³•ã€‚</p><p><img src="https://raw.githubusercontent.com/caffreygo/static/main/blog/Vuejs3/quickDiff.png" alt=""></p><h2 id="ç›¸åŒçš„å‰ç½®å…ƒç´ å’Œåç½®å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#ç›¸åŒçš„å‰ç½®å…ƒç´ å’Œåç½®å…ƒç´ " aria-hidden="true">#</a> ç›¸åŒçš„å‰ç½®å…ƒç´ å’Œåç½®å…ƒç´ </h2><h3 id="çº¯æ–‡æœ¬-diff-ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#çº¯æ–‡æœ¬-diff-ç®—æ³•" aria-hidden="true">#</a> çº¯æ–‡æœ¬ Diff ç®—æ³•</h3><p>ä¸åŒäºç®€å• Diff ç®—æ³•å’ŒåŒç«¯ Diff ç®—æ³•ï¼Œå¿«é€Ÿ Diff ç®—æ³•åŒ…å«é¢„å¤„ç†æ­¥éª¤ï¼Œè¿™å€Ÿé‰´äº†çº¯æ–‡æœ¬ Diff ç®—æ³•çš„æ€è·¯ã€‚åœ¨çº¯æ–‡æœ¬ Diff ç®—æ³•ä¸­ï¼Œå­˜åœ¨å¯¹ä¸¤æ®µæ–‡æœ¬è¿›è¡Œé¢„å¤„ç†çš„è¿‡ç¨‹ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ä¸¤æ®µæ–‡æœ¬è¿›è¡Œ Diff ä¹‹å‰ï¼Œå¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œå…¨ç­‰æ¯”è¾ƒï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>text1 <span class="token operator">===</span> text2<span class="token punctuation">)</span> <span class="token keyword">return</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>è¿™ä¹Ÿæˆä¸º<strong>å¿«æ·è·¯å¾„</strong>ã€‚å¦‚æœä¸¤ç«¯æ–‡æœ¬å†…å®¹ç›¸ç­‰ï¼Œå°±æ— éœ€è¿›å…¥æ ¸å¿ƒ Diff ç®—æ³•çš„æ­¥éª¤äº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒDiff ç®—æ³•è¿˜ä¼šå¤„ç†ä¸¤æ®µæ–‡æœ¬çš„å‰ç¼€å’Œåç¼€ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>TEXT1ï¼š I use vue <span class="token keyword">for</span> app development\nTEXT2ï¼š I use react <span class="token keyword">for</span> app development\n\nTEXT1ï¼švue\nTEXT2ï¼šreact\n<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>\nTEXT1ï¼š I like you\nTEXT2ï¼š I like you too\n\nTEXT1ï¼š\nTEXT2ï¼štoo\n<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>\nTEXT1ï¼š I like you too\nTEXT2ï¼š I like you\n\nTEXT1ï¼štoo\nTEXT2ï¼š\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ï¼Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åˆ¤æ–­æ–‡æœ¬çš„æ’å…¥å’Œåˆ é™¤ã€‚</p><h3 id="å¿«é€Ÿ-diff-ç®—æ³•-1" tabindex="-1"><a class="header-anchor" href="#å¿«é€Ÿ-diff-ç®—æ³•-1" aria-hidden="true">#</a> å¿«é€Ÿ Diff ç®—æ³•</h3><p>å¿«é€Ÿ Diff ç®—æ³•å€Ÿé‰´äº†çº¯æ–‡æœ¬ Diff ç®—æ³•ä¸­çš„<strong>é¢„å¤„ç†</strong>çš„æ­¥éª¤ã€‚å®ƒä¼šå…ˆå¤„ç†ä¸€ä¸‹æ–°æ—§å­èŠ‚ç‚¹é‡Œç›¸åŒçš„å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹ã€‚</p><p><img src="https://raw.githubusercontent.com/caffreygo/static/main/blog/Vuejs3/11.2.1.png" alt=""></p><p>å¤„ç†å®Œå‰ç½®å’Œåç½®èŠ‚ç‚¹ä¹‹åï¼Œæ–°å­èŠ‚ç‚¹æœªå¤„ç†çš„éƒ¨åˆ† <strong>[ j, newEnd ]</strong> åŒºé—´å†…çš„èŠ‚ç‚¹ï¼Œä½œä¸ºæ–°å…ƒç´ æŒ‚è½½ã€‚</p><p><img src="https://raw.githubusercontent.com/caffreygo/static/main/blog/Vuejs3/11.2.2.png" alt=""></p><p>å¤„ç†å®Œå‰ç½®å’Œåç½®èŠ‚ç‚¹ä¹‹åï¼Œæ—§å­èŠ‚ç‚¹æœªå¤„ç†çš„éƒ¨åˆ† <strong>[ j, oldEnd ]</strong> åŒºé—´å†…çš„èŠ‚ç‚¹è¦å¸è½½ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> newChildren <span class="token operator">=</span> n2<span class="token punctuation">.</span>children\n    <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> n1<span class="token punctuation">.</span>children\n    <span class="token comment">// æ›´æ–°ç›¸åŒçš„å‰ç¼€èŠ‚ç‚¹</span>\n    <span class="token comment">// ç´¢å¼• j æŒ‡å‘æ–°æ—§ä¸¤ç»„å­èŠ‚ç‚¹çš„å¼€å¤´</span>\n    <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token keyword">let</span> oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>\n    <span class="token keyword">let</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>\n    <span class="token comment">// while å¾ªç¯å‘åéå†ï¼Œç›´åˆ°é‡åˆ°æ‹¥æœ‰ä¸åŒ key å€¼çš„èŠ‚ç‚¹ä¸ºæ­¢</span>\n    <span class="token keyword">while</span> <span class="token punctuation">(</span>oldVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// è°ƒç”¨ patch å‡½æ•°æ›´æ–°</span>\n        <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>\n        j<span class="token operator">++</span>\n        oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>\n        newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// æ›´æ–°ç›¸åŒçš„åç¼€èŠ‚ç‚¹</span>\n    <span class="token comment">// ç´¢å¼• oldEnd æŒ‡å‘æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>\n    <span class="token keyword">let</span> oldEnd <span class="token operator">=</span> oldChildren<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>\n    <span class="token comment">// ç´¢å¼• newEnd æŒ‡å‘æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>\n    <span class="token keyword">let</span> newEnd <span class="token operator">=</span> newChildren<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>\n\n    oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>oldEnd<span class="token punctuation">]</span>\n    newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newEnd<span class="token punctuation">]</span>\n\n    <span class="token comment">// while å¾ªç¯å‘å‰éå†ï¼Œç›´åˆ°é‡åˆ°æ‹¥æœ‰ä¸åŒ key å€¼çš„èŠ‚ç‚¹ä¸ºæ­¢</span>\n    <span class="token keyword">while</span> <span class="token punctuation">(</span>oldVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// è°ƒç”¨ patch å‡½æ•°æ›´æ–°</span>\n        <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>\n        oldEnd<span class="token operator">--</span>\n        newEnd<span class="token operator">--</span>\n        oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>oldEnd<span class="token punctuation">]</span>\n        newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newEnd<span class="token punctuation">]</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¯´æ˜ä» j -&gt; newEnd ä¹‹é—´çš„èŠ‚ç‚¹åº”ä½œä¸ºæ–°èŠ‚ç‚¹æ’å…¥</span>\n    <span class="token comment">// j &gt; oldEndï¼šæ—§èŠ‚ç‚¹å…¨éƒ¨è¢«å¤„ç†å®Œæ¯•</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> oldEnd <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> newEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// é”šç‚¹çš„ç´¢å¼•</span>\n        <span class="token keyword">const</span> anchorIndex <span class="token operator">=</span> newEnd <span class="token operator">+</span> <span class="token number">1</span>\n        <span class="token comment">// é”šç‚¹å…ƒç´ </span>\n        <span class="token keyword">const</span> anchor <span class="token operator">=</span> anchorIndex <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length <span class="token operator">?</span> newChildren<span class="token punctuation">[</span>anchorIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>el <span class="token operator">:</span> <span class="token keyword">null</span>\n        <span class="token comment">// é‡‡ç”¨ while å¾ªç¯ï¼Œè°ƒç”¨ patch å‡½æ•°é€ä¸ªæŒ‚è½½æ–°å¢çš„èŠ‚ç‚¹</span>\n        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> newEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> newChildren<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> newEnd <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> oldEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// j -&gt; oldEnd ä¹‹é—´çš„èŠ‚ç‚¹åº”è¯¥è¢«å¸è½½</span>\n        <span class="token comment">// j &gt; newndï¼šæ–°èŠ‚ç‚¹å…¨éƒ¨è¢«å¤„ç†å®Œæ¯•</span>\n        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> oldEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">unmount</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> \n<span class="token punctuation">}</span>\n</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlight-line">Â </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">Â </div><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">Â </div><br><br><br><br><br><br><br><br><div class="highlight-line">Â </div><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h2 id="ç§»åŠ¨æ“ä½œåˆ¤æ–­" tabindex="-1"><a class="header-anchor" href="#ç§»åŠ¨æ“ä½œåˆ¤æ–­" aria-hidden="true">#</a> ç§»åŠ¨æ“ä½œåˆ¤æ–­</h2><p>ä¹‹å‰ä»‹ç»äº†å¿«é€Ÿ Diff ç®—æ³•çš„é¢„å¤„ç†è¿‡ç¨‹ï¼Œå³å¤„ç†ç›¸åŒçš„å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹ã€‚</p><p>ä½†æ˜¯ï¼Œä¹‹å‰çš„ä¾‹å­æ¯”è¾ƒç†æƒ³åŒ–ï¼Œæ€»æ˜¯å‡å®šæ–°æ—§å­èŠ‚ç‚¹æœ‰ä¸€ç»„ä¼šè¢«å…¨éƒ¨å¤„ç†å®Œæ¯•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªéœ€è¦ç®€å•åœ°æŒ‚è½½ã€å¸è½½èŠ‚ç‚¹å³å¯ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„ä¸€ç»„æ–°æ—§å­èŠ‚ç‚¹æ¥è¿›è¡Œè¯´æ˜ï¼š</p><p><img src="https://raw.githubusercontent.com/caffreygo/static/main/blog/Vuejs3/quick.2.1.png" alt=""></p><p>ç»è¿‡é¢„å¤„ç†ä¹‹åï¼Œæ— è®ºæ˜¯æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹è¿˜æ˜¯æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹éƒ½æœ‰èŠ‚ç‚¹æœªå¤„ç†ã€‚æˆ‘ä»¬éœ€è¦å¯¹æ­¤è¿›ä¸€æ­¥å¤„ç†ï¼š</p><ul><li>åˆ¤æ–­æ˜¯å¦æœ‰èŠ‚ç‚¹éœ€è¦ç§»åŠ¨ï¼Œä»¥åŠåº”è¯¥å¦‚ä½•ç§»åŠ¨</li><li>æ‰¾å‡ºé‚£äº›éœ€è¦è¢«æ·»åŠ æˆ–ç§»é™¤çš„èŠ‚ç‚¹</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> oldEnd <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> newEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// åªæœ‰éœ€è¦æ–°å¢çš„èŠ‚ç‚¹</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> newEnd <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> oldEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// åªæœ‰éœ€è¦å¸è½½çš„èŠ‚ç‚¹</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token comment">// å¤„ç†éç†æƒ³æƒ…å†µ</span>\n<span class="token punctuation">}</span> \n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="souce-æ•°ç»„" tabindex="-1"><a class="header-anchor" href="#souce-æ•°ç»„" aria-hidden="true">#</a> souce æ•°ç»„</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ª source æ•°ç»„ï¼Œå®ƒçš„é•¿åº¦ä¸ºæ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­å‰©ä½™æœªå¤„ç†èŠ‚ç‚¹çš„æ•°é‡ï¼Œsource æ•°ç»„ç”¨æ¥å­˜å‚¨æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­çš„èŠ‚ç‚¹åœ¨æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­çš„ä½ç½®ç´¢å¼•ï¼Œåé¢å°†ä¼šä½¿ç”¨å®ƒè®¡ç®—å‡ºä¸€ä¸ªæœ€é•¿é€’å¢å­åºåˆ—ï¼Œå¹¶ç”¨äºè¾…åŠ©å®Œæˆ DOM çš„ç§»åŠ¨æ“ä½œã€‚</p><p><img src="https://raw.githubusercontent.com/caffreygo/static/main/blog/Vuejs3/quick.2.2.png" alt=""></p><blockquote><p>å½“éå†å‰©ä½™çš„æ–°å­èŠ‚ç‚¹æ—¶ï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹åœ¨ source ä¸­å¯¹åº”çš„å€¼ä¸º -1ï¼Œè¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹æ— æ³•åœ¨æ—§å­èŠ‚ç‚¹æ•°ç»„ä¸­æ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªéœ€è¦æ–°å¢çš„èŠ‚ç‚¹ã€‚</p></blockquote><p><strong>æ„å»º souce æ•°ç»„</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> oldEnd <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> newEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// åªæœ‰éœ€è¦æ–°å¢çš„èŠ‚ç‚¹</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> newEnd <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> oldEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// åªæœ‰éœ€è¦å¸è½½çš„èŠ‚ç‚¹</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> count <span class="token operator">=</span> newEnd <span class="token operator">-</span> j <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment">// æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­å‰©ä½™æœªå¤„ç†èŠ‚ç‚¹çš„æ•°é‡</span>\n    <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n    source<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>\n    \n    <span class="token comment">// oldStart å’Œ newStart åˆ†åˆ«æœªèµ·å§‹ç´¢å¼•ï¼Œå³ j</span>\n    <span class="token keyword">const</span> oldStart <span class="token operator">=</span> j<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> newStart <span class="token operator">=</span> j<span class="token punctuation">;</span>\n    <span class="token comment">// éå†æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹</span>\n    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> oldStart<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> oldEnd<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span>\n        <span class="token comment">// éå†æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹</span>\n        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token operator">=</span> newStart<span class="token punctuation">;</span> k <span class="token operator">&lt;=</span> newEnd<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">const</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span>\n            <span class="token comment">// æ‰¾åˆ°æ‹¥æœ‰ç›¸åŒ key çš„å¯å¤ç”¨èŠ‚ç‚¹</span>\n            <span class="token keyword">if</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                <span class="token comment">// è°ƒç”¨ patch è¿›è¡Œæ›´æ–°</span>\n                <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>\n                <span class="token comment">// æœ€åå¡«å…… source æ•°ç»„</span>\n                source<span class="token punctuation">[</span>k <span class="token operator">-</span> newStart<span class="token punctuation">]</span> <span class="token operator">=</span> i\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span> \n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><blockquote><p>source è®°å½•çš„æ˜¯<strong>å‰©ä½™æœªå¤„ç†</strong>çš„æ–°å­èŠ‚ç‚¹åœ¨æ—§å­èŠ‚ç‚¹å½“ä¸­çš„å¯å¤ç”¨èŠ‚ç‚¹ï¼Œç´¢å¼•è®°å½•çš„ä¸‹æ ‡è¦å‡å» newStart</p></blockquote><h3 id="ç´¢å¼•è¡¨é™ä½æ—¶é—´å¤æ‚åº¦" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•è¡¨é™ä½æ—¶é—´å¤æ‚åº¦" aria-hidden="true">#</a> ç´¢å¼•è¡¨é™ä½æ—¶é—´å¤æ‚åº¦</h3><p>ğŸš€ å½“å‰çš„åŒå±‚ for å¾ªç¯çš„æ—¶é—´å¤æ‚åº¦æœª O(n^2)ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<strong>ç´¢å¼•è¡¨</strong>æ¥æŠŠæ—¶é—´å¤æ‚åº¦é™ä½åˆ° O(n)</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> oldEnd <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> newEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// åªæœ‰éœ€è¦æ–°å¢çš„èŠ‚ç‚¹</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> newEnd <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> oldEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// åªæœ‰éœ€è¦å¸è½½çš„èŠ‚ç‚¹</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> count <span class="token operator">=</span> newEnd <span class="token operator">-</span> j <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment">// æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­å‰©ä½™æœªå¤„ç†èŠ‚ç‚¹çš„æ•°é‡</span>\n    <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n    source<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>\n\n    <span class="token comment">// oldStart å’Œ newStart åˆ†åˆ«æœªèµ·å§‹ç´¢å¼•ï¼Œå³ j</span>\n    <span class="token keyword">const</span> oldStart <span class="token operator">=</span> j<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> newStart <span class="token operator">=</span> j<span class="token punctuation">;</span>\n    <span class="token comment">// ğŸ”¥ æ„å»ºç´¢å¼•è¡¨</span>\n    <span class="token keyword">const</span> keyIndex <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> newStart<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> newEnd<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        keyIndex<span class="token punctuation">[</span>newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> i\n    <span class="token punctuation">}</span>\n    <span class="token comment">// éå†æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­å‰©ä½™æœªå¤„ç†çš„èŠ‚ç‚¹</span>\n    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> oldStart<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> oldEnd<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span>\n        <span class="token comment">// é€šè¿‡ç´¢å¼•è¡¨å¿«é€Ÿæ‰¾åˆ°æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­å¯å¤ç”¨èŠ‚ç‚¹çš„ä½ç½®</span>\n        <span class="token keyword">const</span> k <span class="token operator">=</span> keyIndex<span class="token punctuation">[</span>oldVNode<span class="token punctuation">.</span>key<span class="token punctuation">]</span>\n        \n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> k <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>k<span class="token punctuation">]</span>\n            <span class="token comment">// è°ƒç”¨ patch å‡½æ•°å®Œæˆæ›´æ–°</span>\n            <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>\n            <span class="token comment">// ğŸš€ å¡«å…… source æ•°ç»„</span>\n            source<span class="token punctuation">[</span>k <span class="token operator">-</span> newStart<span class="token punctuation">]</span> <span class="token operator">=</span> i\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token comment">// æ²¡æ‰¾åˆ°ï¼Œå¸è½½</span>\n            <span class="token function">unmount</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n<span class="token punctuation">}</span> \n</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">Â </div><div class="highlight-line">Â </div><div class="highlight-line">Â </div><div class="highlight-line">Â </div><br><br><br><br><br><br><br><div class="highlight-line">Â </div><div class="highlight-line">Â </div><div class="highlight-line">Â </div><div class="highlight-line">Â </div><div class="highlight-line">Â </div><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">æ„å»º source æ•°ç»„</p><ul><li><p>ç´¢å¼•è¡¨å­˜ç€å‰©ä½™æœªå¤„ç†å­èŠ‚ç‚¹ï¼Œé”®å€¼åˆ†åˆ«ä¸ºèŠ‚ç‚¹ key å’Œæ–°å­èŠ‚ç‚¹æ•°ç»„å½“ä¸­çš„ç´¢å¼•ï¼š</p><p><strong>keyIndex: Record&lt;key, newIdx&gt;</strong></p></li><li><p>åœ¨éå†æ—§å­èŠ‚ç‚¹æ•°ç»„çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ— æ³•åœ¨æ–°å­èŠ‚ç‚¹åˆ—è¡¨ä¸­æ‰¾åˆ°å¯å¤ç”¨èŠ‚ç‚¹ï¼Œåˆ™å¸è½½è¯¥èŠ‚ç‚¹</p></li><li><p>å¦‚æœæ‰¾åˆ°äº†å¯å¤ç”¨èŠ‚ç‚¹ï¼Œåˆ™æŠŠæ–°å­èŠ‚ç‚¹å¯¹åº”çš„æ—§å­èŠ‚ç‚¹çš„ç´¢å¼•è®°å½•åœ¨ source æ•°ç»„å½“ä¸­</p></li></ul></div><h3 id="èŠ‚ç‚¹ç§»åŠ¨åˆ¤æ–­" tabindex="-1"><a class="header-anchor" href="#èŠ‚ç‚¹ç§»åŠ¨åˆ¤æ–­" aria-hidden="true">#</a> èŠ‚ç‚¹ç§»åŠ¨åˆ¤æ–­</h3><p>åœ¨éå†æ—§èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‰¾åˆ°äº†å¯å¤ç”¨èŠ‚ç‚¹ï¼Œéœ€è¦åˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹è¦ä¸è¦ç§»åŠ¨ã€‚</p><ul><li><p>å¦‚æœåœ¨éå†è¿‡ç¨‹ä¸­é‡åˆ°çš„ç´¢å¼•å€¼å‘ˆç°é€’å¢è¶‹åŠ¿ï¼Œåˆ™è¯´æ˜ä¸éœ€è¦ç§»åŠ¨èŠ‚ç‚¹ï¼Œåä¹‹åˆ™éœ€è¦ã€‚</p></li><li><p>åŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæ•°é‡æ ‡è¯†ï¼Œä»£è¡¨å·²ç»æ›´æ–°è¿‡çš„èŠ‚ç‚¹ï¼Œ<strong>æ›´æ–°è¿‡çš„èŠ‚ç‚¹æ•°é‡åº”è¯¥å°äºæ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹æ•°é‡</strong></p><p><code>count = newEnd - newStart + 1</code></p><p>ä¸€æ—¦å‰è€…è¶…è¿‡äº†åè€…ï¼Œåˆ™è¯´æ˜è¿™äº›èŠ‚ç‚¹éƒ½æ˜¯å¤šä½™çš„æ—§èŠ‚ç‚¹ï¼Œåº”è¯¥å°†å®ƒä»¬å¸è½½ã€‚</p></li></ul>',40),t=(0,p._)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,p._)("pre",{class:"language-javascript"},[(0,p._)("code",null,[(0,p._)("span",{class:"token keyword"},"for"),(0,p._)("span",{class:"token punctuation"},"("),(0,p._)("span",{class:"token keyword"},"let"),(0,p.Uk)(" i "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" oldStart"),(0,p._)("span",{class:"token punctuation"},";"),(0,p.Uk)(" i "),(0,p._)("span",{class:"token operator"},"<="),(0,p.Uk)(" oldEnd"),(0,p._)("span",{class:"token punctuation"},";"),(0,p.Uk)(" i"),(0,p._)("span",{class:"token operator"},"++"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n  oldVNode "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" oldChildren"),(0,p._)("span",{class:"token punctuation"},"["),(0,p.Uk)("i"),(0,p._)("span",{class:"token punctuation"},"]"),(0,p.Uk)("\n  "),(0,p._)("span",{class:"token keyword"},"const"),(0,p.Uk)(" k "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" keyIndex"),(0,p._)("span",{class:"token punctuation"},"["),(0,p.Uk)("oldVNode"),(0,p._)("span",{class:"token punctuation"},"."),(0,p.Uk)("key"),(0,p._)("span",{class:"token punctuation"},"]"),(0,p.Uk)("\n\n  "),(0,p._)("span",{class:"token keyword"},"if"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"("),(0,p._)("span",{class:"token keyword"},"typeof"),(0,p.Uk)(" k "),(0,p._)("span",{class:"token operator"},"!=="),(0,p.Uk)(),(0,p._)("span",{class:"token string"},"'undefined'"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n    newVNode "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" newChildren"),(0,p._)("span",{class:"token punctuation"},"["),(0,p.Uk)("k"),(0,p._)("span",{class:"token punctuation"},"]"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token function"},"patch"),(0,p._)("span",{class:"token punctuation"},"("),(0,p.Uk)("oldVNode"),(0,p._)("span",{class:"token punctuation"},","),(0,p.Uk)(" newVNode"),(0,p._)("span",{class:"token punctuation"},","),(0,p.Uk)(" container"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)("\n    source"),(0,p._)("span",{class:"token punctuation"},"["),(0,p.Uk)("k "),(0,p._)("span",{class:"token operator"},"-"),(0,p.Uk)(" newStart"),(0,p._)("span",{class:"token punctuation"},"]"),(0,p.Uk)(),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" i\n    "),(0,p._)("span",{class:"token comment"},"// åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»åŠ¨"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token keyword"},"if"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"("),(0,p.Uk)("k "),(0,p._)("span",{class:"token operator"},"<"),(0,p.Uk)(" pos"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n      moved "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(),(0,p._)("span",{class:"token boolean"},"true"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)(),(0,p._)("span",{class:"token keyword"},"else"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n      pos "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" k\n    "),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)("\n  "),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)(),(0,p._)("span",{class:"token keyword"},"else"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token comment"},"// æ—§èŠ‚ç‚¹æ²¡æœ‰å¯¹åº”çš„å¯å¤ç”¨æ–°èŠ‚ç‚¹ï¼Œå¸è½½å…¶"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token function"},"unmount"),(0,p._)("span",{class:"token punctuation"},"("),(0,p.Uk)("oldVNode"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)("\n  "),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)("\n"),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)("\n")])]),(0,p._)("div",{class:"line-numbers"},[(0,p._)("span",{class:"line-number"},"1"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"2"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"3"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"4"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"5"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"6"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"7"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"8"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"9"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"10"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"11"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"12"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"13"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"14"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"15"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"16"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"17"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"18"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"19"),(0,p._)("br")])],-1),o=(0,p._)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,p._)("pre",{class:"language-javascript"},[(0,p._)("code",null,[(0,p._)("span",{class:"token keyword"},"const"),(0,p.Uk)(" count "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" newEnd "),(0,p._)("span",{class:"token operator"},"-"),(0,p.Uk)(" j "),(0,p._)("span",{class:"token operator"},"+"),(0,p.Uk)(),(0,p._)("span",{class:"token number"},"1"),(0,p.Uk)("  "),(0,p._)("span",{class:"token comment"},"// æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­å‰©ä½™æœªå¤„ç†èŠ‚ç‚¹çš„æ•°é‡"),(0,p.Uk)("\n"),(0,p._)("span",{class:"token comment"},"// ..."),(0,p.Uk)("\n"),(0,p._)("span",{class:"token keyword"},"for"),(0,p._)("span",{class:"token punctuation"},"("),(0,p._)("span",{class:"token keyword"},"let"),(0,p.Uk)(" i "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" oldStart"),(0,p._)("span",{class:"token punctuation"},";"),(0,p.Uk)(" i "),(0,p._)("span",{class:"token operator"},"<="),(0,p.Uk)(" oldEnd"),(0,p._)("span",{class:"token punctuation"},";"),(0,p.Uk)(" i"),(0,p._)("span",{class:"token operator"},"++"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n  oldVNode "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" oldChildren"),(0,p._)("span",{class:"token punctuation"},"["),(0,p.Uk)("i"),(0,p._)("span",{class:"token punctuation"},"]"),(0,p.Uk)("\n  "),(0,p._)("span",{class:"token comment"},"// å¦‚æœæ›´æ–°è¿‡çš„èŠ‚ç‚¹æ•°é‡å°äºéœ€è¦æ›´æ–°çš„èŠ‚ç‚¹æ•°é‡ï¼Œåˆ™æ‰§è¡Œæ›´æ–°"),(0,p.Uk)("\n  "),(0,p._)("span",{class:"token keyword"},"if"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"("),(0,p.Uk)("patched "),(0,p._)("span",{class:"token operator"},"<"),(0,p.Uk)(" count"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token keyword"},"const"),(0,p.Uk)(" k "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" keyIndex"),(0,p._)("span",{class:"token punctuation"},"["),(0,p.Uk)("oldVNode"),(0,p._)("span",{class:"token punctuation"},"."),(0,p.Uk)("key"),(0,p._)("span",{class:"token punctuation"},"]"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token comment"},"// æœ‰å¯å¤ç”¨æ–°èŠ‚ç‚¹ï¼Œæ‰§è¡Œæ›´æ–°"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token keyword"},"if"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"("),(0,p._)("span",{class:"token keyword"},"typeof"),(0,p.Uk)(" k "),(0,p._)("span",{class:"token operator"},"!=="),(0,p.Uk)(),(0,p._)("span",{class:"token string"},"'undefined'"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n      newVNode "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" newChildren"),(0,p._)("span",{class:"token punctuation"},"["),(0,p.Uk)("k"),(0,p._)("span",{class:"token punctuation"},"]"),(0,p.Uk)("\n      "),(0,p._)("span",{class:"token function"},"patch"),(0,p._)("span",{class:"token punctuation"},"("),(0,p.Uk)("oldVNode"),(0,p._)("span",{class:"token punctuation"},","),(0,p.Uk)(" newVNode"),(0,p._)("span",{class:"token punctuation"},","),(0,p.Uk)(" container"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)("\n      patched"),(0,p._)("span",{class:"token operator"},"++"),(0,p.Uk)("\n      source"),(0,p._)("span",{class:"token punctuation"},"["),(0,p.Uk)("k "),(0,p._)("span",{class:"token operator"},"-"),(0,p.Uk)(" newStart"),(0,p._)("span",{class:"token punctuation"},"]"),(0,p.Uk)(),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" i\n      "),(0,p._)("span",{class:"token comment"},"// åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»åŠ¨"),(0,p.Uk)("\n      "),(0,p._)("span",{class:"token keyword"},"if"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"("),(0,p.Uk)("k "),(0,p._)("span",{class:"token operator"},"<"),(0,p.Uk)(" pos"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n        "),(0,p._)("span",{class:"token comment"},"// æ ‡è®° moved ä¸º trueï¼Œè¡¨ç¤ºéœ€è¦ç§»åŠ¨"),(0,p.Uk)("\n        moved "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(),(0,p._)("span",{class:"token boolean"},"true"),(0,p.Uk)("\n      "),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)(),(0,p._)("span",{class:"token keyword"},"else"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n        pos "),(0,p._)("span",{class:"token operator"},"="),(0,p.Uk)(" k\n      "),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)(),(0,p._)("span",{class:"token keyword"},"else"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n      "),(0,p._)("span",{class:"token comment"},"// æ²¡æœ‰å¯¹åº”çš„å¯å¤ç”¨æ–°èŠ‚ç‚¹ï¼Œå¸è½½"),(0,p.Uk)("\n      "),(0,p._)("span",{class:"token function"},"unmount"),(0,p._)("span",{class:"token punctuation"},"("),(0,p.Uk)("oldVNode"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)("\n  "),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)(),(0,p._)("span",{class:"token keyword"},"else"),(0,p.Uk)(),(0,p._)("span",{class:"token punctuation"},"{"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token comment"},"// å¦‚æœæ›´æ–°è¿‡çš„æ—§èŠ‚ç‚¹æ•°é‡è¶…è¿‡äº†éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹æ•°é‡ï¼Œåˆ™å¸è½½å®ƒä»¬"),(0,p.Uk)("\n    "),(0,p._)("span",{class:"token function"},"unmount"),(0,p._)("span",{class:"token punctuation"},"("),(0,p.Uk)("oldVNode"),(0,p._)("span",{class:"token punctuation"},")"),(0,p.Uk)("\n  "),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)("\n"),(0,p._)("span",{class:"token punctuation"},"}"),(0,p.Uk)("\n")])]),(0,p._)("div",{class:"line-numbers"},[(0,p._)("span",{class:"line-number"},"1"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"2"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"3"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"4"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"5"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"6"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"7"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"8"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"9"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"10"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"11"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"12"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"13"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"14"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"15"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"16"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"17"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"18"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"19"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"20"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"21"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"22"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"23"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"24"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"25"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"26"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"27"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"28"),(0,p._)("br"),(0,p._)("span",{class:"line-number"},"29"),(0,p._)("br")])],-1),c=(0,p.uE)('<h2 id="å¦‚ä½•ç§»åŠ¨å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç§»åŠ¨å…ƒç´ " aria-hidden="true">#</a> å¦‚ä½•ç§»åŠ¨å…ƒç´ </h2><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ä¸¤ä¸ªç›®æ ‡ï¼š</p><ul><li>åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œ DOM ç§»åŠ¨æ“ä½œã€‚æˆ‘ä»¬åˆ›å»ºäº†éå† moved ä½œä¸ºæ ‡è¯†ï¼Œå½“å®ƒçš„å€¼ä¸º true æ—¶ï¼Œè¯´æ˜éœ€è¦è¿›è¡Œ DOM ç§»åŠ¨æ“ä½œã€‚</li><li>æ„å»º source æ•°ç»„ã€‚è¯¥æ•°ç»„çš„é•¿åº¦ç­‰äºæ–°çš„ä¸€ç»„å­èŠ‚ç‚¹<strong>å»æ‰</strong>ç›¸åŒçš„å‰ç½®/åç½®èŠ‚ç‚¹åï¼Œå‰©ä½™æœªå¤„ç†èŠ‚ç‚¹çš„æ•°é‡ã€‚source æ•°ç»„ä¸­å­˜å‚¨ç€æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­åœ¨æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­çš„ä½ç½®ï¼Œåé¢æˆ‘ä»¬ä¼šæ ¹æ® source æ•°ç»„è®¡ç®—å‡ºä¸€ä¸ª<strong>æœ€é•¿é€’å¢å­åºåˆ—</strong>ï¼Œç”¨äº DOM ç§»åŠ¨æ“ä½œã€‚</li></ul><h3 id="æœ€é•¿é€’å¢å­åºåˆ—" tabindex="-1"><a class="header-anchor" href="#æœ€é•¿é€’å¢å­åºåˆ—" aria-hidden="true">#</a> æœ€é•¿é€’å¢å­åºåˆ—</h3><p>ç›®å‰çš„ source æ•°ç»„ä¸ºï¼š[2, 3, 1, -1]ã€‚å®ƒè¡¨ç¤ºæ–°å­èŠ‚ç‚¹åœ¨æ—§å­èŠ‚ç‚¹ä¸­çš„ä½ç½®ï¼Œé€šè¿‡æœ€é•¿é€’å¢å­åºåˆ—çš„è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° [2, 3] ä¹Ÿå°±æ˜¯å‰é¢ä¸¤ä¸ªæ–°å­èŠ‚ç‚¹å¯ä»¥ä¿æŒä¸ç§»åŠ¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°ä¸€ä¸ªæœ€å¤§çš„ä¸éœ€è¦ç§»åŠ¨çš„æ–°èŠ‚ç‚¹çš„ç´¢å¼•æ•°ç»„ <strong>[0, 1]</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>moved<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// è®¡ç®— [2, 3, 1, -1] æœ€é•¿é€’å¢å­åºåˆ—</span>\n  <span class="token keyword">const</span> seq <span class="token operator">=</span> <span class="token function">lis</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token comment">// [0, 1]</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ğŸš€ <strong>åœ¨æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­ï¼Œé‡æ–°ç¼–å·åçš„ç´¢å¼•å€¼ä¸º 0 å’Œ 1 çš„è¿™ä¸¤ä¸ªèŠ‚ç‚¹åœ¨æ›´æ–°å‰åé¡ºåºæ²¡æœ‰å˜åŒ–</strong>ã€‚æ¢å¥è¯è¯´ï¼Œé‡æ–°ç¼–å·ä¹‹åï¼Œç´¢å¼•å€¼ä¸º 0 å’Œ 1 çš„èŠ‚ç‚¹ä¸éœ€è¦ç§»åŠ¨ã€‚</p><h3 id="ç§»åŠ¨ä¸æŒ‚è½½" tabindex="-1"><a class="header-anchor" href="#ç§»åŠ¨ä¸æŒ‚è½½" aria-hidden="true">#</a> ç§»åŠ¨ä¸æŒ‚è½½</h3><div class="custom-container tip"><p class="custom-container-title">ä»åå¾€å‰éå†æ–°çš„å­èŠ‚ç‚¹æ•°ç»„ï¼š</p><ol><li>å¦‚æœè¯¥èŠ‚ç‚¹æ²¡æœ‰å¯å¤ç”¨çš„æ—§èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œsource æ•°ç»„é‡Œå¯¹åº”ä¸‹æ ‡çš„å€¼ä¸º -1ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯éœ€è¦æŒ‚è½½çš„æ–°èŠ‚ç‚¹ã€‚</li><li>seq æ˜¯é€’å¢çš„ï¼Œéå†æ–°å­èŠ‚ç‚¹æ˜¯ä»åå¾€å‰çš„ï¼Œé‚£ä¹ˆå¦‚æœæ–°èŠ‚ç‚¹ä¸‹æ ‡å’Œ seq æœªéå†çš„æœ€åè¿™ä¸ªå€¼ä¸ç­‰ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ–°èŠ‚ç‚¹çš„ä¸‹æ ‡ä¸å­˜åœ¨äº seq å½“ä¸­ã€‚åˆ™éœ€è¦ç§»åŠ¨è¯¥èŠ‚ç‚¹ã€‚</li><li>å¦‚æœè¯¥èŠ‚ç‚¹çš„æ–°ä¸‹æ ‡å­˜åœ¨äº seq ä¸­ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸éœ€è¦ç§»åŠ¨ã€‚</li></ol></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>moved<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> seq <span class="token operator">=</span> <span class="token function">lis</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>\n  <span class="token comment">// s æŒ‡å‘æœ€é•¿é€’å¢å­åºåˆ—çš„æœ€åä¸€ä¸ªå€¼</span>\n  <span class="token keyword">let</span> s <span class="token operator">=</span> seq<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>\n  <span class="token keyword">let</span> i <span class="token operator">=</span> count <span class="token operator">-</span> <span class="token number">1</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// è¯´æ˜ç´¢å¼•ä¸º i çš„èŠ‚ç‚¹æ˜¯å…¨æ–°çš„èŠ‚ç‚¹ï¼Œåº”è¯¥å°†å…¶æŒ‚è½½</span>\n      <span class="token comment">// è¯¥èŠ‚ç‚¹åœ¨æ–° children ä¸­çš„çœŸå®ä½ç½®ç´¢å¼•</span>\n      <span class="token keyword">const</span> pos <span class="token operator">=</span> i <span class="token operator">+</span> newStart\n      <span class="token keyword">const</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>pos<span class="token punctuation">]</span>\n      <span class="token comment">// è¯¥èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ç´¢å¼•</span>\n      <span class="token keyword">const</span> nextPos <span class="token operator">=</span> pos <span class="token operator">+</span> <span class="token number">1</span>\n      <span class="token comment">// é”šç‚¹</span>\n      <span class="token keyword">const</span> anchor <span class="token operator">=</span> nextPos <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length\n      <span class="token operator">?</span> newChildren<span class="token punctuation">[</span>nextPos<span class="token punctuation">]</span><span class="token punctuation">.</span>el\n      <span class="token operator">:</span> <span class="token keyword">null</span>\n      <span class="token comment">// æŒ‚è½½ patch</span>\n      <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!==</span> seq<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// è¯´æ˜è¯¥èŠ‚ç‚¹éœ€è¦ç§»åŠ¨</span>\n      <span class="token comment">// è¯¥èŠ‚ç‚¹åœ¨æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­çš„çœŸå®ä½ç½®ç´¢å¼•</span>\n      <span class="token keyword">const</span> pos <span class="token operator">=</span> i <span class="token operator">+</span> newStart\n      <span class="token keyword">const</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>pos<span class="token punctuation">]</span>\n      <span class="token comment">// è¯¥èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ç´¢å¼•</span>\n      <span class="token keyword">const</span> nextPos <span class="token operator">=</span> pos <span class="token operator">+</span> <span class="token number">1</span>\n      <span class="token comment">// é”šç‚¹</span>\n      <span class="token keyword">const</span> anchor <span class="token operator">=</span> nextPos <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length\n      <span class="token operator">?</span> newChildren<span class="token punctuation">[</span>nextPos<span class="token punctuation">]</span><span class="token punctuation">.</span>el\n      <span class="token operator">:</span> <span class="token keyword">null</span>\n      <span class="token comment">// ç§»åŠ¨ insert</span>\n      <span class="token function">insert</span><span class="token punctuation">(</span>newVNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token comment">// å½“ i === seq[j] æ—¶ï¼Œè¯´æ˜è¯¥ä½ç½®çš„èŠ‚ç‚¹ä¸éœ€è¦ç§»åŠ¨</span>\n      <span class="token comment">// å¹¶è®© s æŒ‡å‘ä¸‹ä¸€ä¸ªä½ç½®</span>\n      s<span class="token operator">--</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><details class="custom-container details"><summary>æ—§ [1, 2, 3, 4, 6, 5] =&gt; æ–° [1, 3, 4, 2, 7, 5]</summary><ol><li><p>é¢„å¤„ç†ï¼Œå»é™¤ç›¸åŒçš„å‰ç½®å’Œåç½®èŠ‚ç‚¹ã€‚</p><p>[1, 2, 3, 4, 6, 5] &lt;==&gt; [2, 3, 4, 6]</p></li><li><p>éå†æ—§èŠ‚ç‚¹ï¼Œæ„å»º source æ•°ç»„ï¼Œæ²¡æœ‰æ‰¾åˆ°å¯å¤ç”¨çš„ p-6ï¼Œ<strong>å¸è½½</strong>è¯¥èŠ‚ç‚¹ã€‚</p><p>[1, 2, 3, 4, 5] &lt;==&gt; [2, 3, 4]</p></li><li><p>moved ä¸º trueï¼Œå¼€å§‹ç§»åŠ¨æ“ä½œã€‚</p></li><li><p>p-7 åœ¨ source æ•°ç»„å½“ä¸­çš„ä¸‹æ ‡ä¸º -1ï¼Œæ²¡æœ‰å¯å¤ç”¨æ—§èŠ‚ç‚¹ï¼Œ<strong>æŒ‚è½½</strong> p-7 èŠ‚ç‚¹åˆ° p-5 å‰é¢ã€‚</p><p>[1, 2, 3, 4, 7, 5] &lt;==&gt; [2, 3, 4, 7]</p></li><li><p>p-2 åœ¨ source æ•°ç»„å½“ä¸­çš„ä¸‹æ ‡ä¸º 1ã€‚p-2 çš„æ–°ç´¢å¼• i ä¸º 2ï¼Œä¸ seq[1] å³ 1 ä¸ç­‰ï¼Œè¦<strong>ç§»åŠ¨</strong>åˆ° p-7 å‰é¢ã€‚</p><p>[1, 3, 4, 2, 7, 5] &lt;==&gt; [3, 4, 2, 7]</p></li><li><p>p-4 åœ¨ source æ•°ç»„å½“ä¸­çš„ä¸‹æ ‡ä¸º 3ã€‚p-4 çš„æ–°ç´¢å¼• i ä¸º 1ï¼Œä¸ seq[1] å³ 1 ç›¸ç­‰ï¼Œä¸ç”¨ç§»åŠ¨ã€‚</p><p>[1, 3, 4, 2, 7, 5] &lt;==&gt; [3, 4, 2, 7]</p></li><li><p>p-3 åœ¨ source æ•°ç»„å½“ä¸­çš„ä¸‹æ ‡ä¸º 2ã€‚p-4 çš„æ–°ç´¢å¼• i ä¸º 0ï¼Œä¸ seq[0] å³ 0 ç›¸ç­‰ï¼Œä¸ç”¨ç§»åŠ¨ã€‚</p><p>[1, 3, 4, 2, 7, 5] &lt;==&gt; [3, 4, 2, 7]</p></li><li><p>å¤„ç†å®Œæ¯•ï¼š[1, 3, 4, 2, 7, 5]</p><p>æ•´ä¸ªå¿«é€Ÿ Diff è¿‡ç¨‹ä¸­ä¸€å…±æœ‰ä¸‰æ¬¡ DOM æ“ä½œï¼Œåˆ†åˆ«æ˜¯å¸è½½ p-6ã€æŒ‚è½½ p-7 å’Œç§»åŠ¨ p-2ã€‚</p></li></ol></details><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>ğŸ”¥ å¿«é€Ÿ Diff ç®—æ³•åœ¨å®æµ‹ä¸­<strong>æ€§èƒ½æœ€ä¼˜</strong>ã€‚</p><p>å®ƒå€Ÿé‰´äº†æ–‡æœ¬ Diff ä¸­çš„<strong>é¢„å¤„ç†</strong>æ€è·¯ï¼Œå…ˆå¤„ç†æ–°æ—§ä¸¤ç»„èŠ‚ç‚¹ä¸­ç›¸åŒçš„å‰ç½®èŠ‚ç‚¹å’Œç›¸åŒçš„åç½®èŠ‚ç‚¹ã€‚</p><p>å½“å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹å…¨éƒ¨å¤„ç†å®Œæ¯•ï¼Œå¦‚æœæ— æ³•ç®€å•åœ°é€šè¿‡æŒ‚è½½æ–°èŠ‚ç‚¹æˆ–è€…å¸è½½å·²ç»ä¸å­˜åœ¨çš„æ—§èŠ‚ç‚¹æ¥å®Œæˆæ›´æ–°ï¼Œåˆ™éœ€è¦æ ¹æ®èŠ‚ç‚¹çš„ç´¢å¼•å…³ç³»ï¼Œæ„é€ å‡ºä¸€ä¸ª<strong>æœ€é•¿é€’å¢å­åºåˆ—</strong>ã€‚æœ€é•¿é€’å¢å­åºåˆ—æ‰€æŒ‡å‘çš„èŠ‚ç‚¹å³ä¸ºä¸éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patchChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n2<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n1<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      n1<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">unmount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">setElementText</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> n2<span class="token punctuation">.</span>children<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n2<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n1<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      n1<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token function">unmount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n1<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">setElementText</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> newChildren <span class="token operator">=</span> n2<span class="token punctuation">.</span>children\n  <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> n1<span class="token punctuation">.</span>children\n  <span class="token comment">// æ›´æ–°ç›¸åŒçš„å‰ç¼€èŠ‚ç‚¹</span>\n  <span class="token comment">// ç´¢å¼• j æŒ‡å‘æ–°æ—§ä¸¤ç»„å­èŠ‚ç‚¹çš„å¼€å¤´</span>\n  <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span>\n  <span class="token keyword">let</span> oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>\n  <span class="token keyword">let</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>\n  <span class="token comment">// while å¾ªç¯å‘åéå†ï¼Œç›´åˆ°é‡åˆ°æ‹¥æœ‰ä¸åŒ key å€¼çš„èŠ‚ç‚¹ä¸ºæ­¢</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>oldVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// è°ƒç”¨ patch å‡½æ•°æ›´æ–°</span>\n    <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>\n    j<span class="token operator">++</span>\n    oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>\n    newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// æ›´æ–°ç›¸åŒçš„åç¼€èŠ‚ç‚¹</span>\n  <span class="token comment">// ç´¢å¼• oldEnd æŒ‡å‘æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>\n  <span class="token keyword">let</span> oldEnd <span class="token operator">=</span> oldChildren<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>\n  <span class="token comment">// ç´¢å¼• newEnd æŒ‡å‘æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>\n  <span class="token keyword">let</span> newEnd <span class="token operator">=</span> newChildren<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>\n\n  oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>oldEnd<span class="token punctuation">]</span>\n  newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newEnd<span class="token punctuation">]</span>\n\n  <span class="token comment">// while å¾ªç¯å‘å‰éå†ï¼Œç›´åˆ°é‡åˆ°æ‹¥æœ‰ä¸åŒ key å€¼çš„èŠ‚ç‚¹ä¸ºæ­¢</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>oldVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// è°ƒç”¨ patch å‡½æ•°æ›´æ–°</span>\n    <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>\n    oldEnd<span class="token operator">--</span>\n    newEnd<span class="token operator">--</span>\n    oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>oldEnd<span class="token punctuation">]</span>\n    newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newEnd<span class="token punctuation">]</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¯´æ˜ä» j -&gt; newEnd ä¹‹é—´çš„èŠ‚ç‚¹åº”ä½œä¸ºæ–°èŠ‚ç‚¹æ’å…¥</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> oldEnd <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> newEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// é”šç‚¹çš„ç´¢å¼•</span>\n    <span class="token keyword">const</span> anchorIndex <span class="token operator">=</span> newEnd <span class="token operator">+</span> <span class="token number">1</span>\n    <span class="token comment">// é”šç‚¹å…ƒç´ </span>\n    <span class="token keyword">const</span> anchor <span class="token operator">=</span> anchorIndex <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length <span class="token operator">?</span> newChildren<span class="token punctuation">[</span>anchorIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>el <span class="token operator">:</span> <span class="token keyword">null</span>\n    <span class="token comment">// é‡‡ç”¨ while å¾ªç¯ï¼Œè°ƒç”¨ patch å‡½æ•°é€ä¸ªæŒ‚è½½æ–°å¢çš„èŠ‚ç‚¹</span>\n    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> newEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> newChildren<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> newEnd <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> oldEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// j -&gt; oldEnd ä¹‹é—´çš„èŠ‚ç‚¹åº”è¯¥è¢«å¸è½½</span>\n    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> oldEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">unmount</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token comment">// æ„é€  source æ•°ç»„</span>\n    <span class="token keyword">const</span> count <span class="token operator">=</span> newEnd <span class="token operator">-</span> j <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment">// æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­å‰©ä½™æœªå¤„ç†èŠ‚ç‚¹çš„æ•°é‡</span>\n    <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n    source<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">const</span> oldStart <span class="token operator">=</span> j\n    <span class="token keyword">const</span> newStart <span class="token operator">=</span> j\n    <span class="token keyword">let</span> moved <span class="token operator">=</span> <span class="token boolean">false</span>\n    <span class="token keyword">let</span> pos <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token keyword">const</span> keyIndex <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> newStart<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> newEnd<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      keyIndex<span class="token punctuation">[</span>newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> i\n    <span class="token punctuation">}</span>\n    <span class="token keyword">let</span> patched <span class="token operator">=</span> <span class="token number">0</span>\n    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> oldStart<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> oldEnd<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>patched <span class="token operator">&lt;</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> k <span class="token operator">=</span> keyIndex<span class="token punctuation">[</span>oldVNode<span class="token punctuation">.</span>key<span class="token punctuation">]</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> k <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>k<span class="token punctuation">]</span>\n          <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>\n          patched<span class="token operator">++</span>\n          source<span class="token punctuation">[</span>k <span class="token operator">-</span> newStart<span class="token punctuation">]</span> <span class="token operator">=</span> i\n          <span class="token comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»åŠ¨</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;</span> pos<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            moved <span class="token operator">=</span> <span class="token boolean">true</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            pos <span class="token operator">=</span> k\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          <span class="token comment">// æ²¡æ‰¾åˆ°</span>\n          <span class="token function">unmount</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">unmount</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>moved<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> seq <span class="token operator">=</span> <span class="token function">lis</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>\n      <span class="token comment">// s æŒ‡å‘æœ€é•¿é€’å¢å­åºåˆ—çš„æœ€åä¸€ä¸ªå€¼</span>\n      <span class="token keyword">let</span> s <span class="token operator">=</span> seq<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>\n      <span class="token keyword">let</span> i <span class="token operator">=</span> count <span class="token operator">-</span> <span class="token number">1</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// è¯´æ˜ç´¢å¼•ä¸º i çš„èŠ‚ç‚¹æ˜¯å…¨æ–°çš„èŠ‚ç‚¹ï¼Œåº”è¯¥å°†å…¶æŒ‚è½½</span>\n          <span class="token comment">// è¯¥èŠ‚ç‚¹åœ¨æ–° children ä¸­çš„çœŸå®ä½ç½®ç´¢å¼•</span>\n          <span class="token keyword">const</span> pos <span class="token operator">=</span> i <span class="token operator">+</span> newStart\n          <span class="token keyword">const</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>pos<span class="token punctuation">]</span>\n          <span class="token comment">// è¯¥èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ç´¢å¼•</span>\n          <span class="token keyword">const</span> nextPos <span class="token operator">=</span> pos <span class="token operator">+</span> <span class="token number">1</span>\n          <span class="token comment">// é”šç‚¹</span>\n          <span class="token keyword">const</span> anchor <span class="token operator">=</span> nextPos <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length\n          <span class="token operator">?</span> newChildren<span class="token punctuation">[</span>nextPos<span class="token punctuation">]</span><span class="token punctuation">.</span>el\n          <span class="token operator">:</span> <span class="token keyword">null</span>\n          <span class="token comment">// æŒ‚è½½</span>\n          <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!==</span> seq<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// è¯´æ˜è¯¥èŠ‚ç‚¹éœ€è¦ç§»åŠ¨</span>\n          <span class="token comment">// è¯¥èŠ‚ç‚¹åœ¨æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­çš„çœŸå®ä½ç½®ç´¢å¼•</span>\n          <span class="token keyword">const</span> pos <span class="token operator">=</span> i <span class="token operator">+</span> newStart\n          <span class="token keyword">const</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>pos<span class="token punctuation">]</span>\n          <span class="token comment">// è¯¥èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ç´¢å¼•</span>\n          <span class="token keyword">const</span> nextPos <span class="token operator">=</span> pos <span class="token operator">+</span> <span class="token number">1</span>\n          <span class="token comment">// é”šç‚¹</span>\n          <span class="token keyword">const</span> anchor <span class="token operator">=</span> nextPos <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length\n          <span class="token operator">?</span> newChildren<span class="token punctuation">[</span>nextPos<span class="token punctuation">]</span><span class="token punctuation">.</span>el\n          <span class="token operator">:</span> <span class="token keyword">null</span>\n          <span class="token comment">// ç§»åŠ¨</span>\n          <span class="token function">insert</span><span class="token punctuation">(</span>newVNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          <span class="token comment">// å½“ i === seq[j] æ—¶ï¼Œè¯´æ˜è¯¥ä½ç½®çš„èŠ‚ç‚¹ä¸éœ€è¦ç§»åŠ¨</span>\n          <span class="token comment">// å¹¶è®© s æŒ‡å‘ä¸‹ä¸€ä¸ªä½ç½®</span>\n          s<span class="token operator">--</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br></div></div>',16),l={render:function(n,s){const a=(0,p.up)("CodeGroupItem"),l=(0,p.up)("CodeGroup");return(0,p.wg)(),(0,p.iD)(p.HY,null,[e,(0,p.Wm)(l,null,{default:(0,p.w5)((()=>[(0,p.Wm)(a,{title:"èŠ‚ç‚¹ç§»åŠ¨åˆ¤æ–­"},{default:(0,p.w5)((()=>[t])),_:1}),(0,p.Wm)(a,{title:"å¤šä½™æ—§èŠ‚ç‚¹å¸è½½"},{default:(0,p.w5)((()=>[o])),_:1})])),_:1}),c],64)}}}}]);